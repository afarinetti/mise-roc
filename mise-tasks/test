#!/usr/bin/env bash
#MISE description="Run plugin tests - install and execute tool"
set -euo pipefail

mise plugin link --force roc .
mise cache clear
mise install roc@alpha4-rolling

# echo $(which "roc")

# Capture and display the output while also verifying it
output=$(mise exec "roc@alpha4-rolling" -- "roc" --version)
echo "roc output: $output"

if echo "$output" | grep -q 'roc nightly pre-release, built from commit d73ea109'; then
    echo "✓ Tests passed"
else
    echo "✗ Test failed: expected version 'roc nightly pre-release, built from commit d73ea109'"
    exit 1
fi

mise plugin uninstall roc
mise uninstall roc@alpha4-rolling
